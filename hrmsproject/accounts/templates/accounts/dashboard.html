{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard{% endblock %}

{% block content %}


<div class="dashboard-main-body">
    <div class="d-flex flex-wrap align-items-center justify-content-between gap-3 mb-24 hedline">
  <h6 class="fw-semibold mb-0">Individual Profile</h6>
  
</div>

<div class="row">
  <div class="col-lg-4 col-md-12">
    <div class="row">
    <div class="col-xxl-12 col-xl-12 col-sm-12">
           <div class="card shadow-none border bg-gradient-start-4 h-100">
          <div class="card-body p-10">
            <div class="d-flex flex-wrap align-items-center justify-content-between gap-3 mb-10">
              <div>
                <p class="fw-medium text-primary-light mb-1">Permission Details</p>
                
              </div>
               <div>
              <span class="bg-success-focus text-success-main px-24 py-4 rounded-pill fw-medium text-sm">{{ current_month }}</span>
                
              </div>
            
            
            </div>
              <hr>
              <div class="mt-10 d-flex justify-content-center flex-wrap gap-3">

              <div class="d-inline-flex align-items-center gap-2 p-2 radius-8 border pe-36 br-hover-primary group-item">
                <span class="bg-neutral-100 w-40-px h-40-px text-xl radius-8 d-flex justify-content-center align-items-center text-secondary-light group-hover:bg-primary-600 group-hover:text-white">
                  <iconify-icon icon="mdi:account-check" class="icon"></iconify-icon>
                </span>
                <div class="gov-text">
                  <span class="text-secondary-light text-sm fw-medium">Total Permission</span>
                  <h6 class="text-md fw-semibold mb-0">{{ permission_data.total }}</h6>
                </div>
              </div>

              <div class="d-inline-flex align-items-center gap-2 p-2 radius-8 border pe-36 br-hover-primary group-item">
                <span class="bg-neutral-100  w-40-px h-40-px text-xl radius-8 d-flex justify-content-center align-items-center text-secondary-light group-hover:bg-primary-600 group-hover:text-white">
                  <iconify-icon icon="mdi:calendar-remove" class="icon"></iconify-icon>
                </span>
                <div class="gov-text">
                  <span class="text-secondary-light text-sm fw-medium">Taken</span>
                  <h6 class="text-md fw-semibold mb-0">{{ permission_data.taken }}</h6>
                </div>
              </div>

              <div class="d-inline-flex align-items-center gap-2 p-2 radius-8 border pe-36 br-hover-primary group-item">
                <span class="bg-neutral-100 w-40-px h-40-px text-xl radius-8 d-flex justify-content-center align-items-center text-secondary-light group-hover:bg-primary-600 group-hover:text-white">
                  <iconify-icon icon="mdi:calendar-check" class="icon"></iconify-icon>
                </span>
                <div class="gov-text">
                  <span class="text-secondary-light text-sm fw-medium">Available</span>
                  <h6 class="text-md fw-semibold mb-0">{{ permission_data.available }}</h6>
                </div>
              </div>
               <div class="d-inline-flex align-items-center gap-2 p-2 radius-8 border pe-36 br-hover-primary group-item">
                <span class="bg-neutral-100  w-40-px h-40-px text-xl radius-8 d-flex justify-content-center align-items-center text-secondary-light group-hover:bg-primary-600 group-hover:text-white">
                  <iconify-icon icon="mdi:email-send-outline" class="icon"></iconify-icon>
                </span>
                <div class="gov-text">
                  <span class="text-secondary-light text-sm fw-medium">Request</span>
                  <h6 class="text-md fw-semibold mb-0">{{ permission_data.request }}</h6>
                </div>
              </div>
            </div>
          </div>
        </div>
            </div>
<div class="col-xxl-12 col-xl-12 col-sm-12 mt-10">
           <div class="card shadow-none border bg-blue-light2 h-100">
          <div class="card-body p-10">
            <div class="d-flex flex-wrap align-items-center justify-content-between gap-3 mb-10">
              <div>
                <p class="fw-medium text-primary-light mb-1">Casual Leave</p>
                
              </div>
               <div>
              <span class="bg-info-200 border border-info-400 text-info-600  rounded-pill fw-medium new-bgr">Available - {{ leave_data.casual.available|floatformat:0 }}</span>
                
              </div>
            
            
            </div>
              <hr>
              <div class="mt-10 d-flex justify-content-center flex-wrap gap-3">

              
              <div class="d-inline-flex align-items-center gap-2 p-2 radius-8 border pe-36 br-hover-info group-item gov">
                <span class="bg-info-200  w-40-px h-40-px text-xl radius-8 d-flex justify-content-center align-items-center text-info-600 group-hover:bg-primary-600 group-hover:text-white">
                  <iconify-icon icon="mdi:file-check-outline" class="icon"></iconify-icon>
                </span>
                <div class="gov-text">
                  <span class="text-secondary-light text-sm fw-medium">Applied</span>
                  <h6 class="text-md fw-semibold mb-0">{{ leave_data.casual.applied|floatformat:1 }} days</h6>
                </div>
              </div>

              <div class="d-inline-flex align-items-center gap-2 p-2 radius-8 border pe-36 br-hover-primary group-item gov">
                <span class="bg-info-200  w-40-px h-40-px text-xl radius-8 d-flex justify-content-center align-items-center text-info-600 group-hover:bg-primary-600 group-hover:text-white">
                  <iconify-icon icon="mdi:calendar-check" class="icon"></iconify-icon>
                </span>
                <div class="gov-text">
                  <span class="text-secondary-light text-sm fw-medium">Taken</span>
                  <h6 class="text-md fw-semibold mb-0">{{ leave_data.casual.taken|floatformat:1 }} days</h6>
                </div>
              </div>
           
            </div>
          </div>
        </div>
            </div>

            <div class="col-xxl-12 col-xl-12 col-sm-12 mt-10">
           <div class="card shadow-none border bg-green-light2 h-100">
          <div class="card-body p-10">
            <div class="d-flex flex-wrap align-items-center justify-content-between gap-3 mb-10">
              <div >
                <p class="fw-medium text-primary-light mb-1">Earned Leave</p>
                
              </div>
               <div>
              <span class="bg-success-200 border border-success-400 text-success-600 rounded-pill fw-medium new-bgr">Available - {{ leave_data.earned.available|floatformat:0 }}</span>
                
              </div>
            
            
            </div>
              <hr>
              <div class="mt-10 d-flex justify-content-center flex-wrap gap-3">

              
              <div class="d-inline-flex align-items-center gap-2 p-2 radius-8 border pe-36 br-hover-success group-item gov">
                <span class="bg-success-200  w-40-px h-40-px text-xl radius-8 d-flex justify-content-center align-items-center text-success-600 group-hover:bg-success-600 group-hover:text-white">
                  <iconify-icon icon="mdi:file-check-outline" class="icon"></iconify-icon>
                </span>
                <div class="gov-text">
                  <span class="text-secondary-light text-sm fw-medium">Applied</span>
                  <h6 class="text-md fw-semibold mb-0">{{ leave_data.earned.applied|floatformat:1 }} days</h6>
                </div>
              </div>

              <div class="d-inline-flex align-items-center gap-2 p-2 radius-8 border pe-36 br-hover-success group-item gov">
                <span class="bg-success-200  w-40-px h-40-px text-xl radius-8 d-flex justify-content-center align-items-center text-success-600 group-hover:bg-success-600 group-hover:text-white">
                  <iconify-icon icon="mdi:calendar-check" class="icon"></iconify-icon>
                </span>
                <div class="gov-text">
                  <span class="text-secondary-light text-sm fw-medium">Taken</span>
                  <h6 class="text-md fw-semibold mb-0">{{ leave_data.earned.taken|floatformat:1 }} days</h6>
                </div>
              </div>
           
            </div>
          </div>
        </div>
            </div>

            <div class="col-xxl-12 col-xl-12 col-sm-12 mt-10">
           <div class="card shadow-none border bg-red-light2 h-100">
          <div class="card-body p-10">
            <div class="d-flex flex-wrap align-items-center justify-content-between gap-3 mb-10">
              <div>
                <p class="fw-medium text-primary-light mb-1">Sick Leave</p>
                
              </div>
               <div>
              <span class="bg-danger-200 border border-danger-400 text-danger-600  rounded-pill fw-medium new-bgr">Available - {{ leave_data.sick.available|floatformat:0 }}</span>
                
              </div>
            
            
            </div>
              <hr>
              <div class="mt-10 d-flex justify-content-center flex-wrap gap-3">

              
              <div class="d-inline-flex align-items-center gap-2 p-2 radius-8 border pe-36 br-hover-danger group-item gov">
                <span class="bg-danger-200  w-40-px h-40-px text-xl radius-8 d-flex justify-content-center align-items-center text-danger-600 group-hover:bg-danger-600 group-hover:text-white">
                  <iconify-icon icon="mdi:file-check-outline" class="icon"></iconify-icon>
                </span>
                <div class="gov-text">
                  <span class="text-secondary-light text-sm fw-medium">Applied</span>
                  <h6 class="text-md fw-semibold mb-0">{{ leave_data.sick.applied|floatformat:1 }} days</h6>
                </div>
              </div>

              <div class="d-inline-flex align-items-center gap-2 p-2 radius-8 border pe-36 br-hover-danger group-item gov">
                <span class="bg-danger-200  w-40-px h-40-px text-xl radius-8 d-flex justify-content-center align-items-center text-danger-600 group-hover:bg-danger-600 group-hover:text-white">
                  <iconify-icon icon="mdi:calendar-check" class="icon"></iconify-icon>
                </span>
                <div class="gov-text">
                  <span class="text-secondary-light text-sm fw-medium">Taken</span>
                  <h6 class="text-md fw-semibold mb-0">{{ leave_data.sick.taken|floatformat:1 }} days</h6>
                </div>
              </div>
           
            </div>
          </div>
        </div>
            </div>

            </div>

  </div>
    <div class="col-lg-5 col-md-12">
                <div class="card h-100 p-0">
                    <div class="card-body p-24">
                       <div class="calendar-container" id="calendarContainer" style="max-height: 600px; overflow-y: auto;">
  <div class="calendar-header">{{ current_month }} {{ current_year }}</div>

  <div class="calendar-grid" id="calendarGrid">
    <!-- Day names -->
    <div class="day-name">Sun</div>
    <div class="day-name">Mon</div>
    <div class="day-name">Tue</div>
    <div class="day-name">Wed</div>
    <div class="day-name">Thu</div>
    <div class="day-name">Fri</div>
    <div class="day-name">Sat</div>

    <!-- Calendar days will be generated dynamically -->
  </div>
</div>
                    </div>
                </div>
            </div>
    <div class="col-lg-3 col-md-12 mt-lg-0 mt-3">
        <div class="card h-100 p-0">
                    <div class="card-body p-24">
                    <div class="nft-promo-card card radius-12 overflow-hidden position-relative z-1 mb-3">
                       <h4 class="dn">Announcement</h4>
                        <div class="nft-promo-card__inner d-flex align-items-center">
                                <p class="text-md mb-0">The largest NFT (Non-Fungible Token) marketplace is OpenSea. Established in 2017, OpenSea has grown to become the leading platform for buying, selling, and trading digital assets,</p>
                        </div>
                    </div>
                       <h6 class="lat-hed">Birthday Buddy</h6>
    <div class="chat-all-list">
     {% for buddy in birthday_buddies %}
          <div class="chat-sidebar-single active">
            <div class="img">
              <img src="{% if buddy.profile_image %}{{ buddy.profile_image.url }}{% else %}{% static 'assets/images/users/user1.png' %}{% endif %}" alt="image">
            </div>
            <div class="info">
              <h6 class="text-manual mb-1">{{ buddy.staff_name }}</h6>
              <p class="mb-0 text-xs">({{ buddy.staff_id }})</p>
            </div>
            <div class="action text-end">
              <p class="mb-0 text-neutral-400 text-xs lh-1">{{ buddy.date_of_birth|date:"d M" }}</p>
              {% if buddy.date_of_birth|date:"d" == today|date:"d" %}
              <span class="px-1 py-2-10 text-xs  bg-warning-main text-white d-inline-flex align-items-center justify-content-center">Today</span>
              {% elif buddy.date_of_birth|date:"d"|add:"1" == today|date:"d"|add:"1" %}
              <span class="px-1 py-2-10  text-xs  bg-warning-main text-white d-inline-flex align-items-center justify-content-center">Day After</span>
              {% endif %}
            </div>
          </div>
     {% empty %}
          <div class="chat-sidebar-single active">
            <div class="info">
              <p class="mb-0 text-xs text-muted">No birthdays this month</p>
            </div>
          </div>
     {% endfor %}
</div>
 <h6 class="lat-hed3 mt-3">New Joiner(s) of the Month</h6>
 <div class="chat-all-list2">
  {% for joiner in new_joiners %}
  <div class="chat-sidebar-single active">
            <div class="img">
              <img src="{% if joiner.profile_image %}{{ joiner.profile_image.url }}{% else %}{% static 'assets/images/users/user4.png' %}{% endif %}" alt="image">
            </div>
            <div class="info">
              <h6 class="text-manual mb-1">{{ joiner.staff_name }}</h6>
              <p class="mb-0 text-xs">{{ joiner.designation|default:"Employee" }}</p>
            </div>
            <div class="action text-end">
              <p class="mb-0 text-neutral-400 text-xs lh-1">Joined:<br> {{ joiner.date_of_join|date:"d M Y" }}</p>
            </div>
          </div>
  {% empty %}
          <div class="chat-sidebar-single active">
            <div class="info">
              <p class="mb-0 text-xs text-muted">No new joiners this month</p>
            </div>
          </div>
  {% endfor %}
</div>
            </div>
        </div>
    </div>
</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // Generate dynamic calendar
  const calendarGrid = document.getElementById('calendarGrid');
  const currentMonth = parseInt('{{ today.month }}');
  const currentYear = parseInt('{{ today.year }}');
  const todayDay = parseInt('{{ today.day }}');
  
  // Get first day of month and number of days
  const firstDay = new Date(currentYear, currentMonth - 1, 1).getDay();
  const daysInMonth = new Date(currentYear, currentMonth, 0).getDate();
  
  // Add empty cells for days before month starts
  for (let i = 0; i < firstDay; i++) {
    const emptyDay = document.createElement('div');
    emptyDay.className = 'day';
    calendarGrid.appendChild(emptyDay);
  }
  
  // Add days of the month
  for (let day = 1; day <= daysInMonth; day++) {
    const dayDiv = document.createElement('div');
    dayDiv.className = 'day';
    
    const dateSpan = document.createElement('span');
    dateSpan.className = 'date';
    dateSpan.textContent = day;
    dayDiv.appendChild(dateSpan);
    
    // Add status badge (placeholder - you can make this dynamic based on attendance data)
    // For now, randomly assign statuses for demo
    const statuses = ['present', 'absent', 'leave', 'weekoff', 'pco'];
    const statusLabels = ['Present', 'Absent', 'Leave', 'Week Off', 'Present (Comp-Off)'];
    const statusTexts = ['P', 'A', 'L', 'WO', 'P/CO'];
    const randomIndex = Math.floor(Math.random() * statuses.length);
    const statusType = statuses[randomIndex];
    const statusLabel = statusLabels[randomIndex];
    const statusText = statusTexts[randomIndex];
    
    const statusBadge = document.createElement('div');
    statusBadge.className = `status-badge ${statusType}`;
    statusBadge.textContent = statusText;
    statusBadge.setAttribute('data-tooltip', statusLabel);
    dayDiv.appendChild(statusBadge);
    
    calendarGrid.appendChild(dayDiv);
  }
  
  // Make calendar scrollable - ensure it can scroll to bottom
  const calendarContainer = document.getElementById('calendarContainer');
  if (calendarContainer) {
    calendarContainer.style.overflowY = 'auto';
    calendarContainer.style.maxHeight = '600px';
    calendarContainer.style.height = '600px';
    // Scroll to bottom after a short delay to ensure content is rendered
    setTimeout(() => {
      if (calendarContainer.scrollHeight > calendarContainer.clientHeight) {
        calendarContainer.scrollTop = calendarContainer.scrollHeight;
      }
    }, 100);
  }
  
  // First container
  const container1 = document.querySelector('.chat-all-list');
  let scrollAmount1 = 0;
  const scrollSpeed1 = 0.3;
  const intervalDelay1 = 40;
  let intervalId1;

  function startScrolling1() {
    intervalId1 = setInterval(() => {
      scrollAmount1 += scrollSpeed1;
      if (scrollAmount1 >= container1.scrollHeight - container1.clientHeight) {
        scrollAmount1 = 0;
      }
      container1.scrollTop = scrollAmount1;
    }, intervalDelay1);
  }

  function stopScrolling1() {
    clearInterval(intervalId1);
  }

  container1.addEventListener('mouseenter', stopScrolling1);
  container1.addEventListener('mouseleave', startScrolling1);
  startScrolling1();


  // Second container
  const container2 = document.querySelector('.chat-all-list2');
  let scrollAmount2 = 0;
  const scrollSpeed2 = 0.3;
  const intervalDelay2 = 40;
  let intervalId2;

  function startScrolling2() {
    intervalId2 = setInterval(() => {
      scrollAmount2 += scrollSpeed2;
      if (scrollAmount2 >= container2.scrollHeight - container2.clientHeight) {
        scrollAmount2 = 0;
      }
      container2.scrollTop = scrollAmount2;
    }, intervalDelay2);
  }

  function stopScrolling2() {
    clearInterval(intervalId2);
  }

  container2.addEventListener('mouseenter', stopScrolling2);
  container2.addEventListener('mouseleave', startScrolling2);
  startScrolling2();
});
</script>

{% endblock %}
